<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
	<meta charset="UTF-8">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="/javascript/common/modalScreen.js"></script>
	<link rel="stylesheet" href="/css/common/modalScreen.css">
	<title>프로필</title>
	
	<style>
	
	.showBlock {
	  border: 2px solid red; /* 빨간색 실선 테두리 */
	}
		
	</style>
	
	<script th:inline="javascript">
	
		$(function(){
			
			console.log([[${profile.user.profileImageName}]])
			
			const myProfile = [[${myProfile}]];
			const isFollow = [[${isFollow}]];
			
			if(myProfile == true || myProfile == "true") {
				
				$('#myProfile').css('display','block');
					
			} else {
				
				$('#otherProfile').css('display','block');
				
				if (isFollow == true || isFollow == "true") {
					
					$('#deleteFollow').css('display','block');
					
				} else {
					
					$('#addFollow').css('display','block');
					
				}
			}

		});
	
		$(function() { 
			
			const userId = [[${profile.user.userId}]];
			
			console.log(userId);
			$('#back').on('click', function() {
				
				// window.location.href="/timeline/getTimelineList?userId="+userId;
				history.back();
			});
			
			$('#follow-list').on('click', function() {
				
				window.location.href="/user/getFollowList?userId="+userId;
			});
			
			$('#follower-list').on('click', function() {
				
				window.location.href="/user/getFollowerList?userId="+userId;
			});
			
			$('#updateProfile').on('click', function() {
				
				window.location.href="/user/getUpdateProfileView?userId="+userId;
			});
			
			$('#voiceChat').on('click', function() {
				
				window.location.href="/video-call/"+userId;
			});
						
			$('#deleteFollow').on('click', function() {
				
				$.ajax({
			      url: "/user/rest/deleteFollow",
			      method: "POST",
			      data: {
			        targetId: userId
			      },
			      success: function(response) {
			        
					if(response == true || response == "true") {
						
						$('#deleteFollow').attr('display', 'none');
						$('#addFollow').attr('display', 'block');
						
					} else {
						
						console.log('false');
						alert('변경 실패...');
						
					}
			      },
			      error: function(xhr, status, error) {
			        console.error("네트워크 오류:", error);
			        alert("네트워크 오류");
			      }
			    });
		    });
		
			$('#addFollow').on('click', function() {
				
				$.ajax({
			      url: "/user/rest/deleteFollow",
			      method: "POST",
			      data: {
			        targetId: userId
			      },
			      success: function(response) {
			        
					if(response == true || response == "true") {
						
						$('#deleteFollow').attr('display', 'block');
						$('#addFollow').attr('display', 'none');
						
					} else {
						
						console.log('false');
						alert('변경 실패...');
						
					}
			      },
			      error: function(xhr, status, error) {
			        console.error("네트워크 오류:", error);
			        alert("네트워크 오류");
			      }
			    });
			});
			
			$('#myChatList').on('click', function() {
				
				window.location.href="https://mapmory.co.kr/video-call/chatlist";
			});
			
			$('#chat').on('click', function() {
				
				const sessionId = [[${sessionId}]];
				
				$.ajax({
	               url: "https://mapmory.co.kr/chatting/findOneChatRoom",
	               method: "POST",
	               data: JSON.stringify({
	                userId: sessionId,
	                 opponent: userId
	               }),
	               success: function(response) {
	                 
	               if(response != null) {
	
	                  console.log("채팅서버 응답 : " + response);
	                  window.location.href="/video-call/chatroom/"+response;
	                  
	               } else {
	                  
	                  console.log("실패");
	                  
	               }
               }
			});
		});
		
		$(function() {
			
			$('#toggleButton').on('click', function() {
				
				openModal();
				
			});
			
		});
	</script>
	
</head>
<body>
	
	<button type="button" id="back">뒤로 가기</button>
	
	<button type="button" id="toggleButton">=</button>

	<ul class="profile-info">
	  <li id="shared-list" class="showBlock">
	    <span class="label">공유기록 수</span>
	    <span class="value" th:text="${profile.totalSharedListCount}"></span>
	  </li>
	  <li id="follow-list" class="showBlock">
	    <span class="label">팔로워</span>
	    <span class="value" th:text="${profile.totalFollowCount}"></span>
	  </li>
	  <li id="follower-list" class="showBlock">
	    <span class="label">팔로잉</span>
	    <span class="value" th:text="${profile.totalFollowerCount}"></span>
	  </li>
	</ul>
	
	<h3>자기소개</h3>
	<p th:text="${profile.user.introduction}"></p>

	<div id="myProfile" style="display:none;">
		<button type="button" id="updateProfile">내 프로필 수정</button>
		<button type="button" id="myChatList">내 채팅 목록으로 이동</button>
	</div>
	<div id="otherProfile" style="display:none;">
		<div>
			<button type="button" id="deleteFollow" style="display:none;">언팔로우</button>
			<button type="button" id="addFollow" style="display:none;">팔로우</button>
		</div>
		<button type="button" id="voiceChat">화상통화</button>
		<button type="button" id="chat">메세지 보내기</button>
	</div>
	
	<div id="toggle" class="modal">
		
	
	</div>
	
	<img alt="" th:src="${profile.user.profileImageName}">
</body>	
</html>