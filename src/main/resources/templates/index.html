<!DOCTYPE html>
<html>
<head>
    <title>로그인</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
 		$(function() {
 			
			$('#login').on('click', function() {
        		
        		$.ajax({
                    type: "POST",
                    url: "/user/rest/login",
                    contentType: "application/json",
                    data: JSON.stringify({
                        userId: $("#username").val(),
                        userPassword: $("#password").val()
                    }),
                    success: function(response) {
                    	
                    	// console.log("_"+response+"_");
                    	console.log("server 응답 : "+ response);
                        if (response == "true" || response == true) {
                        	
                        	console.log("로그인 성공!");
                            // submitSession();
                            console.log("cookie를 요청합니다...");
                        	$('form').attr('method', 'post').attr('action', '/user/login').submit();
                        }
                    },
                    error: function(jqXHR) {
                        alert("오류 발생: " + jqXHR.responseText);
                    }
                });
        	});
			
			
			$('#logout').on('click', function() {
				
				$('form').attr('method', 'post').attr('action', '/user/logout').submit();
			});
			
			$('#mapView').on('click', function() {
				
				window.location.href="http://localhost:8000/map";
			});
			
			$('#footerView').on('click', function() {
				
				window.location.href="http://localhost:8000/common/footer";
			});
 		});
    </script>
</head>
<body>
    <form id="loginForm">
    
        <input type="text" id="username" name="userId" placeholder="아이디">
        <br/>
        <input type="password" id="password" name="userPassword" placeholder="비밀번호">
        <br/>   
        
        <input type="checkbox" name="keepLogin" value="true"/>
        <label for="keepLogin">로그인 유지</label>
        
        <button type="button" id="login">로그인</button>
        <br/>
        <br/>
        <button type="button" id="logout">로그아웃</button>

		<details>
		  <summary>사용자 테스트 방법 (비밀번호 암호화 정책 적용)</summary>
		  <ol>
		    <li>
		      'users' 테이블에서 `password` 열의 길이를 120으로 변경합니다. (또는 현재 데이터베이스를 삭제하고 개인용 스크립트를 다시 붙여넣어도 됩니다.)
		    </li>
		    <li>
		      'UserController'의 `setupForTest()` [전) getLoginView()]에서 주석 처리된 `userService.setupForTest();` 부분을 활성화합니다.
		    </li>
		    <li>
		      해당 URL로 접속합니다.
		    </li>
		  </ol>
		  <br>
		
		  **번외:** 모든 사용자의 비밀번호를 암호화하고 싶다면, `UserServiceImpl`의 `setupForTest()`에서 `user1`, `user2` 변경 코드를 비활성화하고 위에 주석 처리된 부분을 활성화한 후 2번부터 시행해주세요.
		</details>
         
        <br/>
        <br/>
        <button type="button" id="mapView">map으로 바로 이동</button>
        <button type="button" id="footerView">footer 실험실로 이동</button>
    </form> 
</body>
</html>
