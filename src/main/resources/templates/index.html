<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>인덱스</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
</head>
<body>
    <h1 th:text="${'Hello World'}"></h1>
    <a href="/timeline/getDetailTimeline" th:text="${'getDetailTimeline'}"></a><br/>
    <a href="/timeline/getDetailTimeline2" th:text="${'getDetailTimeline2'}"></a><br/>
   <div id="captchaImageContainer">
    <!-- 캡차 이미지가 표시될 곳 -->
</div>
        <input type="text" id="captcha-input" placeholder="Enter Captcha">
        <button id="verify-button">확인</button>
    </div>
       <div class="container">
    <div>
        <input type="text" class="form-control" id="phone" name="phone" placeholder="번호">
        <input type="button" id="memberPhoneCheck" class="btn active" value="인증번호 전송">
    </div>
    <div>
        <input type="text" name="memberPhoneCertify" class="form-control phoneNum" placeholder="인증번호">
        <input type="button" id="certifyCheck" class="btn" value="인증하기">
    </div>
    <input type="hidden" name="phone" th:value="${phone}">
</div>
    <div id="kakao"></div>
		<a class="p-2" id = "kakao-login-btn" href="https://kauth.kakao.com/oauth/authorize?client_id=cec50764919801119a69066d40036533&redirect_uri=http://localhost:8000/user/kakaoLogin&response_type=code">
		


    <div th:include="~{ 'common/chatbotModal.html' }"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    // script.js

$(document).ready(function() {
  var captchaKey;

  function loadCaptcha() {
    $.get("/api/captcha/nkey?code=0", function(response) {
      captchaKey = JSON.parse(response).key;
      var captchaImageUrl = "/api/captcha/image?key=" + captchaKey;
      $("#captchaImageContainer").html($("<img>").attr("src", captchaImageUrl));
    });
  }

  $("#verify-button").click(function() {
    var captchaValue = $("#captcha-input").val();

    $.ajax({
      url: "/api/captcha/verify",
      method: "GET",
      data: {
        key: captchaKey,
        value: captchaValue
      },
      success: function(response) {
        var result = JSON.parse(response);
        if (result.result) {
          alert("캡차 확인 성공!");
        } else {
          alert("캡차를 다시 확인해주세요.");
          loadCaptcha(); // 새로운 캡차 이미지 로드
        }
      },
      error: function(xhr, status, error) {
        console.error("캡차 검증 실패:", error);
        alert("캡차를 다시 확인해주세요.");
        loadCaptcha(); // 새로운 캡차 이미지 로드
      }
    });
  });

  loadCaptcha(); // 페이지 로드 시 캡차 로드
});
    
$(document).ready(function() {
	Kakao.init('bde4d0b1dd558fcdac6b04e0ba243c20');
	Kakao.Auth.createLoginButton({
		container: '#kakao-login-btn',
		success: function (authObj) {
		},
		fail: function (err) {
			alert(JSON.stringify(err));
		}
	});
});

$(document).ready(function() {
    var checkNum;

    $('#memberPhoneCheck').click(function () {
        var phone = $('#phone').val();

        $.ajax({
            url: "/user/memberPhoneCheck",
            type: "POST",
            data: { to: phone },
            dataType: "json",
            success: function (data) {
                checkNum = data;
                alert('checkNum:' + checkNum);
            },
            error: function () {
                alert("에러");
            }
        });
    });

    $('#certifyCheck').click(function () {
        var userNum = $('input[name="memberPhoneCertify"]').val();
        if (checkNum == userNum) {
            alert('인증 성공하였습니다.');
        } else {
            alert('인증 실패하였습니다. 다시 입력해주세요.');
        }
    });
});
</script>



</body>
</html>
